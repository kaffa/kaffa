<!DOCTYPE html>
<html lang="zh-cn">
<head>
      <title>Kaffa.im - 在 Windows 10 下安装 Wechaty</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Pelican" />
    <meta name="author" content="Kaffa" />
    <!--
        Q1. 本站技术栈？
        A1. 本站目前版本V2，主要技术栈有 reStructuredText, Markdown, Pelican, kaffa-theme, Bulma, Github Pages

        Q2. 更多信息？
        A2. 微信公众号：Kaffa
    -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/bulma/css/bulma.min.css">
    <link rel="stylesheet" href="/css/bulma-divider.min.css">
    <link rel="stylesheet" href="/css/0.css">




    <meta name="tags" content="随笔" />
    <meta name="tags" content="Essays" />
    <meta name="tags" content="技术" />
    <meta name="tags" content="Technology" />
    <meta name="tags" content="Wechaty" />
    <meta name="tags" content="Node" />
    <meta name="tags" content="Node.js" />
    <meta name="tags" content="Open Source" />

</head>
<body>
    <header>
        <nav class="navbar container is-max-widescreen" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
                <h1 class="navbar-item"><a href="./">
                    Kaffa.im</a>
                </h1>
              <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div class="navbar-menu">
                <div class="navbar-start">
                </div>
                <div class="navbar-end">
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">笔记</a>
                        <div class="navbar-dropdown">
                            <a class="navbar-item" href="javascript:;">网站</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="javascript:;">读书</a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">创作</a>
                        <div class="navbar-dropdown">
                            <a class="navbar-item" href="javascript:;">文章</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="javascript:;">书单</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="javascript:;">周报</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="javascript:;">概念</a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">我的</a>
                        <div class="navbar-dropdown">
                            <a class="navbar-item" href="javascript:;">书</a>
                            <a class="navbar-item" href="javascript:;">影</a>
                            <a class="navbar-item" href="javascript:;">音</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="javascript:;">物</a>
                        </div>
                    </div>
                    <div class="navbar-item has-dropdown is-hoverable">
                        <a class="navbar-link">关于</a>
                        <div class="navbar-dropdown">
                            <a class="navbar-item" href="/pages/about.html">站长</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="mailto:admin@kaffa.im?subject=Hello%20from%20&body=你好，">联系</a>
                            <hr class="navbar-divider">
                            <a class="navbar-item" href="mailto:admin@kaffa.im?subject=Hello%20from%20&body=网站反馈：">网站反馈</a>
                        </div>
                    </div>
                    <!--
                    <div class="navbar-item">
                        <div class="buttons">
                            <a class="button is-primary">
                            <strong>Sign up</strong>
                            </a>
                            <a class="button is-light">
                            Log in
                            </a>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </nav>
    </header>
    <main class="has-background-grey-lighter">
  <header>
    <h1 class="entry-title">
      <a href="./wechaty-installation-on-windows-10.html" rel="bookmark"
         title="Permalink to 在 Windows 10 下安装 Wechaty">在 Windows 10 下安装 Wechaty</a></h1>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2018-07-24T12:00:00+08:00">
      2018-07-24 周二
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="./author/kaffa.html">Kaffa</a>
    </address>
    <div class="category">
        Category: <a href="./category/sui-bi.html">随笔</a>
    </div>
    <div class="tags">
        Tags:
            <a href="./tag/sui-bi.html">随笔</a>
            <a href="./tag/essays.html">Essays</a>
            <a href="./tag/ji-zhu.html">技术</a>
            <a href="./tag/technology.html">Technology</a>
            <a href="./tag/wechaty.html">Wechaty</a>
            <a href="./tag/node.html">Node</a>
            <a href="./tag/nodejs.html">Node.js</a>
            <a href="./tag/open-source.html">Open Source</a>
    </div>
  </footer><!-- /.post-info -->
  <article>
    <div class="section" id="section-1">
<h2>介绍</h2>
<p><a class="reference external" href="https://github.com/Chatie/wechaty">Wechaty</a> 是一个对话机器人软件开发包，它可以帮你用 6 行 JavaScript 代码实现一个微信个人账号。由于使用 node 技术，它支持 Linux、Windows、macOS 平台和 Docker 容器。它的安装过程和其它 node 包类似，首先 <tt class="docutils literal">git clone</tt> 源代码，再使用 node 的 npm 命令 <tt class="docutils literal">npm install &amp; npm start</tt> 实现开箱即用，同时官方也提供了入门案例：<a class="reference external" href="https://github.com/Chatie/wechaty-getting-started">Wechaty getting started</a>。而在国内，实际安装过程中可能会因某些软件依赖的原因遇到问题，本文记录了安装过程中可能会出现的错误及解决办法，下面描述详细的步骤和说明：</p>
<div class="section" id="section-2">
<h3>概念</h3>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Chatie/wechaty">Wechaty</a></dt>
<dd>项目地址</dd>
<dt><a class="reference external" href="https://github.com/Chatie/wechaty-getting-started">Wechaty Getting Started</a></dt>
<dd>Wechaty 起步</dd>
<dt><a class="reference external" href="https://chatie.io/wechaty/">Wechaty Documents</a></dt>
<dd>Wechaty 文档</dd>
<dt><a class="reference external" href="https://github.com/Chatie/wechaty/wiki/Puppet">Puppet</a></dt>
<dd>一个包含了机器人对话逻辑的抽象类，是 Wechaty 技术架构的一部分。继承实现 Puppet 抽象类（协议）的组件，即可实现更广泛的与联系人、消息/一对一对话、群组/聊天室/多对多对话等相关逻辑。Puppet 的中文是木偶，用在这里相当传神。</dd>
<dt><a class="reference external" href="https://www.npmjs.com/package/node-gyp">node-gyp</a></dt>
<dd>基于 gyp 编写的用来编译 node 本地扩展模块的 node 包，而 gpy 是 Chromium 项目上用于实现跨平台编译的工具。
安装文档：<a class="reference external" href="https://github.com/nodejs/node-gyp#installation">https://github.com/nodejs/node-gyp#installation</a></dd>
<dt><a class="reference external" href="https://www.npmjs.com/package/windows-build-tools">windows-build-tools</a></dt>
<dd>node 包装的 Windows 平台的编译工具
安装文档：<a class="reference external" href="https://github.com/felixrieseberg/windows-build-tools">https://github.com/felixrieseberg/windows-build-tools</a></dd>
<dt><a class="reference external" href="https://www.npmjs.com/package/node-expat">node-expat</a></dt>
<dd>基于 <a class="reference external" href="https://libexpat.github.io/">libexpat</a> 的用来处理 XML 的 node 包，libexpat 是一个号称最快的 XML 解析库，纯 C 语言编写。Wechaty 使用它解析基于 XML 的通讯。
安装文档：<a class="reference external" href="https://www.npmjs.com/package/node-expat">https://www.npmjs.com/package/node-expat</a></dd>
<dt><a class="reference external" href="https://www.python.org/downloads/">Python 2.7</a></dt>
<dd>一门愈久弥新的语言，node-gyp 的依赖 Python 2.7 实现跨平台编译</dd>
<dt><a class="reference external" href="https://github.com/GoogleChrome/puppeteer">puppeteer</a></dt>
<dd>可编程的 Google Chrome， Google Chrome 团队官方出品。</dd>
<dt><a class="reference external" href="https://www.chromium.org/">Chromium</a></dt>
<dd>puppeteer 依赖一个特定的 Chromium 版本，Chrome 就是 开源 Chromium + Google 开发的闭源的扩展包。</dd>
</dl>
</div>
<div class="section" id="section-3">
<h3>安装步骤</h3>
<ol class="arabic simple">
<li>下载 Wechaty 源代码</li>
<li>安装依赖，配置</li>
<li><tt class="docutils literal">npm install &amp; npm start</tt> 启动</li>
</ol>
</div>
</div>
<div class="section" id="section-4">
<h2>详细步骤</h2>
<ol class="arabic simple">
<li>下载 Wechaty 源代码</li>
</ol>
<p>首先我们建立源代码目录，本文使用 <tt class="docutils literal"><span class="pre">D:\code</span></tt>。如果你使用了其他目录，在后文中作相应的替换即可。
让我们从入门项目开始，运行以下命令下载，并进入项目目录:</p>
<pre class="literal-block">
git clone https://github.com/lijiarui/wechaty-getting-started.git
cd wechaty-getting-started
</pre>
<ol class="arabic simple" start="2">
<li>安装依赖</li>
</ol>
<p>首先安装 <strong>node-v10.x.x</strong>。在 Windows 下，推荐使用官方提供的安装包，截至本文最新 64 位系统安装包是：<a class="reference external" href="https://nodejs.org/dist/v10.7.0/node-v10.7.0-x64.msi">https://nodejs.org/dist/v10.7.0/node-v10.7.0-x64.msi</a>，如果网速不够，建议使用迅雷下载。</p>
<p>除了 node-v10 ，Wechaty 也依赖其它软件，而由于众所周知的网络原因，安装它们并不会太顺利。</p>
<p>此时，如果运行 <tt class="docutils literal">npm install &amp; npm start</tt>，会报以下错误:</p>
<pre class="literal-block">
Microsoft Windows [版本 10.0.16299.492]
(c) 2017 Microsoft Corporation。保留所有权利。


D:\code&gt;cd wechaty-getting-started

D:\code\wechaty-getting-started&gt;npm install
npm notice created a lockfile as package-lock.json. You should commit this file.
added 134 packages from 94 contributors and audited 324 packages in 22.581s
found 0 vulnerabilities


D:\code\wechaty-getting-started&gt;npm start

&gt; wechaty-getting-started&#64;0.1.0 start D:\code\wechaty-getting-started
&gt; node examples/starter-bot.js

01:59:34 INFO Wechaty &lt;default&gt; start() v0.18.5 is starting...
01:59:34 INFO Wechaty initPuppet() using puppet: default
01:59:34 INFO PuppetConfig installPuppet(wechaty-puppet-puppeteer&#64;^0.4.2) please wait ...
npm:
&gt; node-expat&#64;2.3.16 install D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
&gt; node-gyp rebuild


npm:
D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat&gt;if not defined npm_config_node_gyp (node &quot;D:\Program Files\nodejs\node_modules\npm\node_modules\npm-lifecycle\node-gyp-bin\\..\..\node_modules\node-gyp\bin\node-gyp.js&quot; rebuild )  else (node &quot;D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\bin\node-gyp.js&quot; rebuild )

npm: gyp
npm:  ERR! configure error
gyp ERR! stack Error: Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:483:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:508:16)
gyp ERR! stack     at D:\Program Files\nodejs\node_modules\npm\node_modules\graceful-fs\polyfills.js:284:29
gyp ERR! stack     at FSReqWrap.oncomplete (fs.js:158:21)
gyp ERR! System Windows_NT 10.0.16299

npm: gyp ERR! command &quot;D:\\Program Files\\nodejs\\node.exe&quot; &quot;D:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
gyp ERR! node -v v10.7.0
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok

npm: npm WARN
npm:  wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of brolog&#64;^1.6.5 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of file-box&#64;^0.8.22 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of hot-import&#64;^0.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of lru-cache&#64;^4.1.3 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of qr-image&#64;^3.2.0 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of promise-retry&#64;^1.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rxjs&#64;^6.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rx-queue&#64;^0.4.26 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of state-switch&#64;^0.6.2 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of watchdog&#64;^0.8.10 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of wechaty-puppet&#64;^0.6.4 but none is installed. You must install peer dependencies yourself.


npm: npm ERR!
npm:  code ELIFECYCLE
npm ERR! errno 1
npm ERR! node-expat&#64;2.3.16 install: `node-gyp rebuild`
npm ERR! Exit status 1

npm: npm ERR!
npm ERR! Failed at the node-expat&#64;2.3.16 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm:
npm
npm:  ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\username\AppData\Roaming\npm-cache\_logs\2018-07-22T17_59_53_633Z-debug.log

01:59:53 ERR PupptConfig puppetResolver(default) install fail: Command failed: npm install wechaty-puppet-puppeteer&#64;^0.4.2
gyp ERR! configure error
gyp ERR! stack Error: Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:483:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:508:16)
gyp ERR! stack     at D:\Program Files\nodejs\node_modules\npm\node_modules\graceful-fs\polyfills.js:284:29
gyp ERR! stack     at FSReqWrap.oncomplete (fs.js:158:21)
gyp ERR! System Windows_NT 10.0.16299
gyp ERR! command &quot;D:\\Program Files\\nodejs\\node.exe&quot; &quot;D:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
gyp ERR! node -v v10.7.0
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of brolog&#64;^1.6.5 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of file-box&#64;^0.8.22 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of hot-import&#64;^0.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of lru-cache&#64;^4.1.3 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of qr-image&#64;^3.2.0 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of promise-retry&#64;^1.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rxjs&#64;^6.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rx-queue&#64;^0.4.26 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of state-switch&#64;^0.6.2 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of watchdog&#64;^0.8.10 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of wechaty-puppet&#64;^0.6.4 but none is installed. You must install peer dependencies yourself.

npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! node-expat&#64;2.3.16 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the node-expat&#64;2.3.16 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\username\AppData\Roaming\npm-cache\_logs\2018-07-22T17_59_53_633Z-debug.log

{ Error: Command failed: npm install wechaty-puppet-puppeteer&#64;^0.4.2
gyp ERR! configure error
gyp ERR! stack Error: Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:483:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:508:16)
gyp ERR! stack     at D:\Program Files\nodejs\node_modules\npm\node_modules\graceful-fs\polyfills.js:284:29
gyp ERR! stack     at FSReqWrap.oncomplete (fs.js:158:21)
gyp ERR! System Windows_NT 10.0.16299
gyp ERR! command &quot;D:\\Program Files\\nodejs\\node.exe&quot; &quot;D:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
gyp ERR! node -v v10.7.0
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of brolog&#64;^1.6.5 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of file-box&#64;^0.8.22 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of hot-import&#64;^0.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of lru-cache&#64;^4.1.3 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of qr-image&#64;^3.2.0 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of promise-retry&#64;^1.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rxjs&#64;^6.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rx-queue&#64;^0.4.26 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of state-switch&#64;^0.6.2 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of watchdog&#64;^0.8.10 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of wechaty-puppet&#64;^0.6.4 but none is installed. You must install peer dependencies yourself.

npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! node-expat&#64;2.3.16 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the node-expat&#64;2.3.16 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\username\AppData\Roaming\npm-cache\_logs\2018-07-22T17_59_53_633Z-debug.log

    at ChildProcess.exithandler (child_process.js:291:12)
    at ChildProcess.emit (events.js:182:13)
    at ChildProcess.EventEmitter.emit (domain.js:442:20)
    at maybeClose (internal/child_process.js:961:16)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:248:5)
killed: false,
code: 1,
signal: null,
cmd: 'npm install wechaty-puppet-puppeteer&#64;^0.4.2 ' }
01:59:53 ERR Wechaty start() exception: Command failed: npm install wechaty-puppet-puppeteer&#64;^0.4.2
gyp ERR! configure error
gyp ERR! stack Error: Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:483:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:508:16)
gyp ERR! stack     at D:\Program Files\nodejs\node_modules\npm\node_modules\graceful-fs\polyfills.js:284:29
gyp ERR! stack     at FSReqWrap.oncomplete (fs.js:158:21)
gyp ERR! System Windows_NT 10.0.16299
gyp ERR! command &quot;D:\\Program Files\\nodejs\\node.exe&quot; &quot;D:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
gyp ERR! node -v v10.7.0
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of brolog&#64;^1.6.5 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of file-box&#64;^0.8.22 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of hot-import&#64;^0.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of lru-cache&#64;^4.1.3 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of qr-image&#64;^3.2.0 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of promise-retry&#64;^1.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rxjs&#64;^6.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rx-queue&#64;^0.4.26 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of state-switch&#64;^0.6.2 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of watchdog&#64;^0.8.10 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of wechaty-puppet&#64;^0.6.4 but none is installed. You must install peer dependencies yourself.

npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! node-expat&#64;2.3.16 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the node-expat&#64;2.3.16 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\username\AppData\Roaming\npm-cache\_logs\2018-07-22T17_59_53_633Z-debug.log

{ Error: Command failed: npm install wechaty-puppet-puppeteer&#64;^0.4.2
gyp ERR! configure error
gyp ERR! stack Error: Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
gyp ERR! stack     at PythonFinder.failNoPython (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:483:19)
gyp ERR! stack     at PythonFinder.&lt;anonymous&gt; (D:\Program Files\nodejs\node_modules\npm\node_modules\node-gyp\lib\configure.js:508:16)
gyp ERR! stack     at D:\Program Files\nodejs\node_modules\npm\node_modules\graceful-fs\polyfills.js:284:29
gyp ERR! stack     at FSReqWrap.oncomplete (fs.js:158:21)
gyp ERR! System Windows_NT 10.0.16299
gyp ERR! command &quot;D:\\Program Files\\nodejs\\node.exe&quot; &quot;D:\\Program Files\\nodejs\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&quot; &quot;rebuild&quot;
gyp ERR! cwd D:\code\wechaty-getting-started\node_modules\wechaty\node_modules\node-expat
gyp ERR! node -v v10.7.0
gyp ERR! node-gyp -v v3.6.2
gyp ERR! not ok
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of brolog&#64;^1.6.5 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of file-box&#64;^0.8.22 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of hot-import&#64;^0.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of lru-cache&#64;^4.1.3 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of qr-image&#64;^3.2.0 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of promise-retry&#64;^1.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rxjs&#64;^6.2.1 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of rx-queue&#64;^0.4.26 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of state-switch&#64;^0.6.2 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of watchdog&#64;^0.8.10 but none is installed. You must install peer dependencies yourself.
npm WARN wechaty-puppet-puppeteer&#64;0.4.2 requires a peer of wechaty-puppet&#64;^0.6.4 but none is installed. You must install peer dependencies yourself.

npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! node-expat&#64;2.3.16 install: `node-gyp rebuild`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the node-expat&#64;2.3.16 install script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\username\AppData\Roaming\npm-cache\_logs\2018-07-22T17_59_53_633Z-debug.log

    at ChildProcess.exithandler (child_process.js:291:12)
    at ChildProcess.emit (events.js:182:13)
    at ChildProcess.EventEmitter.emit (domain.js:442:20)
    at maybeClose (internal/child_process.js:961:16)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:248:5)
killed: false,
code: 1,
signal: null,
cmd: 'npm install wechaty-puppet-puppeteer&#64;^0.4.2 ' }

D:\code\wechaty-getting-started&gt;
</pre>
<p>通过阅读上述日志，分析依赖关系如下:</p>
<pre class="literal-block">
wechaty-puppet-puppeteer --&gt; node-expat --&gt; node-gyp --&gt; gyp --&gt; Python 2.7 &amp; Windows Build Tools
</pre>
<p>所以，接下来要做的就是一一从依赖的最底层安装</p>
<ol class="arabic simple">
<li>安装 <a class="reference external" href="https://www.python.org/downloads/">Python 2.7</a> 至 <tt class="docutils literal"><span class="pre">C:\Python27\python.exe</span></tt>，设置环境变量 <tt class="docutils literal"><span class="pre">PYTHON=C:\Python27\python.exe</span></tt></li>
</ol>
<p>注意 node-gyp 并不支持 Python 3.x，如果你安装了 Python 3.x，错误日志如下:</p>
<pre class="literal-block">
Can't find Python executable &quot;C:\Python36\python.EXE&quot;, you can set the PYTHON env variable.
</pre>
<p>你可能会疑惑这个本来存在的 Python 3 路径，个人认为这个不准确错误提示可以算入 npm 包的 Bug</p>
<ol class="arabic simple" start="2">
<li>安装 <a class="reference external" href="https://www.npmjs.com/package/windows-build-tools">windows-build-tools</a></li>
</ol>
<p>参考 windows-build-tools 官方文档，有以下两种方式:</p>
<pre class="literal-block">
1.Visual C++ Build Tools
2.Visual Studio 2017 / Visual Studio 2015
</pre>
<p>我这里由于已经安装 Visual Studio 2017 社区版，所以没有尝试其他选项。这里的关键是需要一个 VC++ 编译器来编译 Windows 本地程序。选项1在微软官方地址已失效，不容易找到，npm 官方推荐了安装 Visual Studio 2015。
安装结束后，可以使用 <tt class="docutils literal">npm install <span class="pre">node-expat</span></tt> 验证上述安装配置是否成功</p>
<ol class="arabic simple" start="3">
<li>安装 <a class="reference external" href="https://github.com/GoogleChrome/puppeteer">puppeteer</a></li>
</ol>
<p>由于网络原因，puppeteer 依赖的 <a class="reference external" href="https://www.chromium.org/">Chromium</a> 并不能顺利安装。此时，我们可以借助一个阿里巴巴公司提供的 <a class="reference external" href="https://npm.taobao.org/">cnpm</a> 特色工具安装:</p>
<pre class="literal-block">
npm install -g cnpm --registry=https://registry.npm.taobao.org
cnpm install puppeteer
</pre>
<p>如果你遇到 <tt class="docutils literal">Chromium revision is not downloaded.</tt> 时，在解决办法中看到的设置 PUPPETEER_SKIP_CHROMIUM_DOWNLOAD 其实是一个误导，
这个选项并不能帮助你安装 puppeteer，而是让你在更新时不必每次都下载 Chromium 二进制。</p>
<p>PS: 这里还有一个手动安装办法，但不推荐：可以手动下载 chromium 安装包，放在 /node_modules/puppeteer/.local-chromium/ 下，例如:</p>
<pre class="literal-block">
D:\code\wechaty-getting-started\node_modules\_puppeteer&#64;1.6.0&#64;puppeteer\.local-chromium\win64-571375
</pre>
<p>这个地址在 macOS 上如下，其中的数字可能不同:</p>
<pre class="literal-block">
~/node_modules/puppeteer/.local-chromium/mac-526987/chrome-mac
</pre>
<ol class="arabic simple" start="4">
<li>.NET Framework 4.5.1 [仅 Windows Vista / 7 需要]</li>
</ol>
<p>如果 Windows Vista / 7 版本，则需要手动安装 .Net Framework</p>
<ol class="arabic" start="5">
<li><p class="first">如果使用的是 PadChat 组件的 Wechaty，且已有相应 token 则还需要设置以下几个环境变量:</p>
<pre class="literal-block">
WECHATY_LOG=silly
WECHATY_PUPPET=padchat
WECHATY_PUPPET_PADCHAT_TOKEN=*YOUR-TOKEN*
</pre>
</li>
<li><p class="first">至此，应该可以顺利运行起步项目:</p>
<pre class="literal-block">
npm install &amp; npm start
</pre>
</li>
<li><p class="first">运行后，程序会在控制台窗口打开一个文本的二维码，在二维码下方是该二维码的网址。</p>
</li>
</ol>
<p>如果你对扫描控制台的文本二维码遇到问题，可以参考我的 <a class="reference external" href="https://kaffa.im/a-story-about-text-qrcode.html">一篇关于二维码的博文</a>。</p>
</div>
<div class="section" id="section-5">
<h2>总结</h2>
<p>由于已成功启动项目，所以我并没有在 Windows 7 系统 或 32 位机上进行配置，主要问题应该差不多。
解决办法基本上一一查阅上述出现错误的软件的文档，应该可以独立解决。</p>
<p>当然，如果你遇到了任何其他问题，也欢迎 <a class="reference external" href="https://github.com/kaffa">我的Github</a> 上联系我。</p>
<p>感谢阅读。</p>
</div>

  </article>
    </main>
    <footer class="footer is-max-widescreen">
        <div class="content has-text-centered">
            Copyright &copy; 2018-2013 <strong>Kaffa.im</strong> by <a href="https://kaffa.im">Kaffa</a>.
            <p>The templates code is licensed
            <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content
            is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.
            </p>
        </div>
    </footer>
</body>

</html>